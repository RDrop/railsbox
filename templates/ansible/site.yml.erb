---
- hosts: vm
  roles:
    - swap

- hosts: dockerhost
  roles:
    - docker

- hosts: application
  handlers:
    <% params[:background_jobs].each do |bg| -%>
    - include: roles/<%= bg %>/handlers/main.yml
    <% end %>
  roles:
    - base
    - ruby
    - vim
    - webserver

<% params[:background_jobs].each do |bg| -%>
- hosts: <%= bg %>
  handlers:
    - include: roles/<%= server_role %>/handlers/main.yml
  roles:
    - base
    - ruby
    - <%= bg %>
<% end %>

<% params[:databases].each do |db| -%>
- hosts: <%= db %>
  roles:
    - <%= db %>

<% end %>